import{_ as X}from"./_5kmRz0s.js";import{g as S,o as a,c as o,a as e,t as p,p as D,l as c,m as E,d as P,n as R,F as I,r as O,z as j,E as M,D as Y,j as Z,k as x,q as N,v as L,s as K,x as tt,y as et,A as y,b as U,w as st}from"./BAtAs9mt.js";import{_ as A}from"./DlAUqK2U.js";import{T as at}from"./BrtjI_6p.js";import{C as nt}from"./BkNlCzdX.js";import{u as ot}from"./Bws3j-4N.js";import{u as lt}from"./D1QnkK4h.js";import{u as rt}from"./HdmTA0kg.js";const it={class:"flex items-start justify-between mb-2"},dt={class:"font-medium text-gray-900 text-sm line-clamp-2"},ct={class:"flex items-center gap-1 flex-shrink-0 ml-2"},ut={key:0,class:"text-xs text-gray-600 mb-2 line-clamp-2"},mt={key:1,class:"mb-2"},kt=["title"],xt={class:"flex items-center gap-2 flex-wrap"},ft={key:0,class:"text-red-500 text-xs",title:"–í–∞–∂–Ω–æ–µ"},vt={key:1,class:"text-orange-500 text-xs",title:"–°—Ä–æ—á–Ω–æ–µ"},bt={key:2,class:"text-xs text-gray-500"},pt={key:3,class:"text-xs text-gray-500"},gt={key:2,class:"flex gap-1 mt-2 flex-wrap"},yt=S({__name:"KanbanCard",props:{task:{}},emits:["click","edit","delete"],setup(t){const v=i=>i?new Date(i).toLocaleDateString("ru-RU",{day:"numeric",month:"short"}):"";return(i,l)=>(a(),o("div",{class:"bg-white rounded-lg shadow p-3 mb-2 cursor-pointer hover:shadow-md transition-shadow",onClick:l[2]||(l[2]=u=>i.$emit("click",t.task))},[e("div",it,[e("h4",dt,p(t.task.title),1),e("div",ct,[e("button",{onClick:l[0]||(l[0]=D(u=>i.$emit("edit",t.task),["stop"])),class:"text-gray-400 hover:text-blue-600",title:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"}," ‚úèÔ∏è "),e("button",{onClick:l[1]||(l[1]=D(u=>i.$emit("delete",t.task.id),["stop"])),class:"text-gray-400 hover:text-red-600",title:"–£–¥–∞–ª–∏—Ç—å"}," üóëÔ∏è ")])]),t.task.description?(a(),o("p",ut,p(t.task.description),1)):c("",!0),t.task.project?(a(),o("div",mt,[e("span",{class:"inline-flex items-center gap-1 px-2 py-0.5 text-xs rounded-full font-medium",style:E({backgroundColor:t.task.project.color+"20",color:t.task.project.color||"#3B82F6"}),title:t.task.project.name},[t.task.project.color?(a(),o("span",{key:0,class:"w-2 h-2 rounded-full",style:E({backgroundColor:t.task.project.color})},null,4)):c("",!0),P(" "+p(t.task.project.name),1)],12,kt)])):c("",!0),e("div",xt,[e("span",{class:R(["px-2 py-0.5 text-xs rounded",t.task.priority==="CRITICAL"?"bg-red-600 text-white":t.task.priority==="HIGH"?"bg-red-100 text-red-800":t.task.priority==="MEDIUM"?"bg-yellow-100 text-yellow-800":t.task.priority==="LOW"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},p(t.task.priority),3),t.task.isImportant?(a(),o("span",ft,"üî¥")):c("",!0),t.task.isUrgent?(a(),o("span",vt,"‚ö°")):c("",!0),t.task.dueDate?(a(),o("span",bt," üìÖ "+p(v(t.task.dueDate)),1)):c("",!0),t.task.estimatedTime?(a(),o("span",pt," ‚è±Ô∏è "+p(t.task.estimatedTime)+"–º ",1)):c("",!0)]),t.task.tags?.length?(a(),o("div",gt,[(a(!0),o(I,null,O(t.task.tags,u=>(a(),o("span",{key:u.tagId,class:"px-2 py-0.5 text-xs rounded text-white",style:E({backgroundColor:u.tag.color})},p(u.tag.name),5))),128))])):c("",!0)]))}}),ht=Object.assign(yt,{__name:"KanbanCard"}),wt={class:"kanban-column"},Tt={class:"flex items-center justify-between mb-3"},$t={class:"flex items-center gap-2"},Ct={class:"font-semibold text-gray-700"},Dt={class:"text-xs text-gray-500 bg-white/50 px-2 py-0.5 rounded-full"},_t={key:0,class:"h-32 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center text-gray-400 text-sm"},jt=S({__name:"KanbanColumn",props:{column:{},tasks:{}},emits:["add-task","move-task","click","delete"],setup(t,{emit:v}){const i=t,l=v,u=(r,n)=>{r.dataTransfer?.setData("taskId",n.id),r.dataTransfer?.setData("fromStatus",n.status||"")},b=r=>{r.preventDefault();const n=r.dataTransfer?.getData("taskId"),g=r.dataTransfer?.getData("fromStatus");n&&g!==i.column.id&&l("move-task",n,i.column.id)},h=r=>{r.preventDefault()};return(r,n)=>{const g=ht;return a(),o("div",wt,[e("div",Tt,[e("div",$t,[e("span",{class:R(`w-3 h-3 rounded-full ${t.column.color}`)},null,2),e("h3",Ct,p(t.column.title),1),e("span",Dt,p(t.tasks.length),1)]),e("button",{onClick:n[0]||(n[0]=m=>r.$emit("add-task")),class:"text-gray-400 hover:text-gray-600 text-lg",title:"–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É"}," + ")]),e("div",{class:"space-y-2 min-h-[500px] max-h-[calc(100vh-250px)] overflow-y-auto p-2",onDragover:D(h,["prevent"]),onDrop:b},[(a(!0),o(I,null,O(t.tasks,m=>(a(),j(g,{key:m.id,task:m,draggable:"true",onClick:d=>r.$emit("click",m),onDelete:n[1]||(n[1]=d=>r.$emit("delete",d)),onDragstart:d=>u(d,m)},null,8,["task","onClick","onDragstart"]))),128)),t.tasks.length===0?(a(),o("div",_t," –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∑–∞–¥–∞—á—É —Å—é–¥–∞ ")):c("",!0)],32)])}}}),It=Object.assign(A(jt,[["__scopeId","data-v-2924ace7"]]),{__name:"KanbanColumn"});function St(){const t=ot(),v=[{id:"NEW",title:"–ù–æ–≤—ã–µ",color:"bg-blue-500"},{id:"IN_PROGRESS",title:"–í –ø—Ä–æ—Ü–µ—Å—Å–µ",color:"bg-yellow-500"},{id:"PAUSED",title:"–ù–∞ –ø–∞—É–∑–µ",color:"bg-gray-500"},{id:"WAITING",title:"–û–∂–∏–¥–∞–Ω–∏–µ",color:"bg-purple-500"},{id:"COMPLETED",title:"–ó–∞–≤–µ—Ä—à–µ–Ω–æ",color:"bg-green-500"}],i=n=>t.tasks.filter(g=>g.status===n),l=async()=>t.fetchTasks(),u=async n=>t.createTask(n),b=async n=>t.updateTask(n),h=async n=>t.deleteTask(n),r=async(n,g)=>{const m=Y();try{const d=await $fetch("/api/tasks/move",{method:"POST",headers:{Authorization:`Bearer ${m.token}`,"Content-Type":"application/json"},body:{taskId:n,status:g}});return await l(),d.data}catch(d){throw d}};return{columns:v,tasks:M(()=>t.tasks),loading:M(()=>t.loading),error:M(()=>t.error),getTasksForColumn:i,fetchTasks:l,createTask:u,updateTask:b,deleteTask:h,moveTask:r}}const Et={class:"kanban-board"},Mt={class:"flex gap-4 pb-4 w-fit mx-auto"},Nt={key:0,class:"fixed inset-0 flex items-center justify-center bg-gray-50 z-50"},Kt={class:"flex justify-end space-x-2"},Ot=S({__name:"KanbanBoard",setup(t){const{columns:v,getTasksForColumn:i,fetchTasks:l,createTask:u,updateTask:b,deleteTask:h,moveTask:r}=St(),{projects:n,fetchProjects:g}=lt(),m=y(!1),d=y(""),T=y(""),_=y("MEDIUM"),w=y(null),$=y(null),C=y(!1),B=y(!1);Z(async()=>{await Promise.all([l(),g()]),B.value=!0});const V=async(f,s)=>{await r(f,s)},z=f=>{w.value=f},F=f=>{w.value=f},W=f=>{$.value=f,C.value=!0},G=f=>{$.value=f,C.value=!0},H=async()=>{$.value&&(await h($.value),$.value=null,C.value=!1,w.value=null,await l())},q=async f=>{await b(f),w.value=null,await l()},J=async()=>{d.value.trim()&&(await u({title:d.value,description:T.value,priority:_.value,status:"NEW"}),d.value="",T.value="",m.value=!1,await l())};return(f,s)=>{const Q=It;return a(),o(I,null,[e("div",Et,[e("div",Mt,[(a(!0),o(I,null,O(x(v),k=>(a(),j(Q,{key:k.id,column:k,tasks:x(i)(k.id),onAddTask:s[0]||(s[0]=Ht=>m.value=!0),onMoveTask:V,onClick:z,onEdit:F,onDelete:W},null,8,["column","tasks"]))),128))])]),x(B)?c("",!0):(a(),o("div",Nt,[...s[9]||(s[9]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e("p",{class:"text-gray-600"},"–ó–∞–≥—Ä—É–∑–∫–∞...")],-1)])])),x(w)?(a(),j(at,{key:1,task:x(w),projects:x(n),onClose:s[1]||(s[1]=k=>w.value=null),onSave:q,onDelete:G},null,8,["task","projects"])):c("",!0),x(C)?(a(),j(nt,{key:2,title:"–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?",message:"–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.",type:"danger","confirm-text":"–£–¥–∞–ª–∏—Ç—å","cancel-text":"–û—Ç–º–µ–Ω–∞",onConfirm:H,onCancel:s[2]||(s[2]=k=>C.value=!1)})):c("",!0),x(m)?(a(),o("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:s[8]||(s[8]=k=>m.value=!1)},[e("div",{class:"bg-white rounded-lg p-6 w-full max-w-md",onClick:s[7]||(s[7]=D(()=>{},["stop"]))},[s[12]||(s[12]=e("h3",{class:"text-lg font-semibold mb-4"},"–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞",-1)),e("form",{onSubmit:D(J,["prevent"])},[N(e("input",{"onUpdate:modelValue":s[3]||(s[3]=k=>K(d)?d.value=k:null),type:"text",placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏",class:"input-base mb-4",autofocus:""},null,512),[[L,x(d)]]),N(e("textarea",{"onUpdate:modelValue":s[4]||(s[4]=k=>K(T)?T.value=k:null),placeholder:"–û–ø–∏—Å–∞–Ω–∏–µ",class:"input-base mb-4",rows:"3"},null,512),[[L,x(T)]]),N(e("select",{"onUpdate:modelValue":s[5]||(s[5]=k=>K(_)?_.value=k:null),class:"input-base mb-4"},[...s[10]||(s[10]=[et('<option value="NONE" data-v-d85b05b6>–ë–µ–∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞</option><option value="LOW" data-v-d85b05b6>–ù–∏–∑–∫–∏–π</option><option value="MEDIUM" data-v-d85b05b6>–°—Ä–µ–¥–Ω–∏–π</option><option value="HIGH" data-v-d85b05b6>–í—ã—Å–æ–∫–∏–π</option><option value="CRITICAL" data-v-d85b05b6>–ö—Ä–∏—Ç–∏—á–Ω—ã–π</option>',5)])],512),[[tt,x(_)]]),e("div",Kt,[e("button",{type:"button",onClick:s[6]||(s[6]=k=>m.value=!1),class:"btn-secondary"}," –û—Ç–º–µ–Ω–∞ "),s[11]||(s[11]=e("button",{type:"submit",class:"btn-primary"},"–°–æ–∑–¥–∞—Ç—å",-1))])],32)])])):c("",!0)],64)}}}),At=Object.assign(A(Ot,[["__scopeId","data-v-d85b05b6"]]),{__name:"KanbanBoard"}),Bt={class:"kanban-page"},Lt={class:"bg-white shadow-sm border-b flex-shrink-0"},Ut={class:"max-w-[1920px] mx-auto px-4 sm:px-6 lg:px-8"},Pt={class:"flex justify-between items-center h-16"},Rt={class:"flex items-center space-x-4"},Vt={class:"flex items-center space-x-4"},zt={key:0,class:"text-sm text-gray-600"},Ft={class:"flex-1 overflow-x-auto p-6"},Wt={class:"h-full flex items-start justify-center"},Gt=S({__name:"index",setup(t){const{user:v,logout:i}=rt(),l=async()=>{await i()};return(u,b)=>{const h=X,r=At;return a(),o("div",Bt,[e("header",Lt,[e("div",Ut,[e("div",Pt,[e("div",Rt,[U(h,{to:"/",class:"text-blue-600 hover:underline"},{default:st(()=>[...b[0]||(b[0]=[P("‚Üê –ù–∞–∑–∞–¥",-1)])]),_:1}),b[1]||(b[1]=e("h1",{class:"text-xl font-bold text-gray-900"},"Kanban –¥–æ—Å–∫–∞",-1))]),e("div",Vt,[x(v)?(a(),o("span",zt,p(x(v).name),1)):c("",!0),e("button",{onClick:l,class:"text-sm text-gray-600 hover:text-gray-900"}," –í—ã–π—Ç–∏ ")])])])]),e("main",Ft,[e("div",Wt,[U(r)])])])}}}),se=A(Gt,[["__scopeId","data-v-e16c0e78"]]);export{se as default};
