import{_ as Y}from"./_5kmRz0s.js";import{g as N,I as A,c as r,a as s,t as u,k as l,n as f,F as $,r as S,l as w,p as I,A as D,o as a,m as V,E as j,j as P,D as W,b as q,w as G,z as H,s as J,d as K}from"./BAtAs9mt.js";import{u as Q}from"./HdmTA0kg.js";const X={class:"card"},Z={class:"flex justify-between items-center mb-6"},ee={class:"flex items-center gap-4"},te={class:"text-xl font-semibold text-gray-900"},se={class:"flex gap-2"},ne={key:0,class:"month-view"},oe={class:"grid grid-cols-7 gap-px bg-gray-200 border border-gray-200 rounded-lg overflow-hidden mb-2"},ae={class:"grid grid-cols-7 gap-px bg-gray-200 border border-gray-200 rounded-lg overflow-hidden"},re=["onClick"],le={class:"flex justify-between items-start mb-1"},ie={key:0,class:"text-xs text-gray-500"},de={class:"space-y-1"},ce=["title"],ue={key:0,class:"text-xs text-gray-500"},ge={key:1,class:"week-view"},ve={class:"grid grid-cols-8 gap-px bg-gray-200 border border-gray-200 rounded-lg overflow-hidden"},ye={class:"text-sm font-medium text-gray-700"},me={key:2,class:"day-view p-4"},he={class:"text-lg font-semibold mb-4"},xe={class:"space-y-2"},fe={class:"font-medium"},be={class:"text-sm text-gray-600"},_e={key:0,class:"text-gray-500 text-center py-8"},pe={class:"text-lg font-semibold mb-4"},we={class:"text-gray-600 mb-4"},De={class:"flex justify-end"},ke=N({__name:"CalendarView",props:{events:{default:()=>[]},eventsModifiers:{}},emits:["update:events"],setup(L){const M=A(L,"events"),i=D("month"),n=D(new Date),m=D(new Date),h=D(null),T=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],b=j(()=>{if(i.value==="month")return n.value.toLocaleDateString("ru-RU",{month:"long",year:"numeric"});if(i.value==="week"){const o=p(n.value),t=new Date(o);return t.setDate(t.getDate()+6),`${o.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})} - ${t.toLocaleDateString("ru-RU",{day:"numeric",month:"short",year:"numeric"})}`}return n.value.toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"})}),d=j(()=>{const o=n.value.getFullYear(),t=n.value.getMonth(),e=new Date(o,t,1),v=new Date(o,t+1,0),y=[],F=new Date,E=e.getDay()||7;for(let g=E-1;g>0;g--){const c=new Date(o,t,-g+1);y.push({day:c.getDate(),date:c,currentMonth:!1,isToday:C(c,F),events:x(c),eventsCount:x(c).length})}for(let g=1;g<=v.getDate();g++){const c=new Date(o,t,g);y.push({day:g,date:c,currentMonth:!0,isToday:C(c,F),events:x(c),eventsCount:x(c).length})}const O=42-y.length;for(let g=1;g<=O;g++){const c=new Date(o,t+1,g);y.push({day:g,date:c,currentMonth:!1,isToday:C(c,F),events:x(c),eventsCount:x(c).length})}return y}),k=j(()=>{const o=p(n.value),t=[],e=new Date;for(let v=0;v<7;v++){const y=new Date(o);y.setDate(y.getDate()+v),t.push({day:y.getDate(),weekday:T[v],date:y,isToday:C(y,e)})}return t}),_=j(()=>x(m.value));function p(o){const t=new Date(o),e=t.getDay()||7;return t.setDate(t.getDate()-e+1),t}function x(o){return M.value.filter(t=>{const e=new Date(t.start);return C(e,o)})}function C(o,t){return o.getFullYear()===t.getFullYear()&&o.getMonth()===t.getMonth()&&o.getDate()===t.getDate()}function R(){i.value==="month"?n.value.setMonth(n.value.getMonth()-1):i.value==="week"?n.value.setDate(n.value.getDate()-7):n.value.setDate(n.value.getDate()-1)}function U(){i.value==="month"?n.value.setMonth(n.value.getMonth()+1):i.value==="week"?n.value.setDate(n.value.getDate()+7):n.value.setDate(n.value.getDate()+1)}function z(){n.value=new Date,m.value=new Date}function B(o){m.value=o.date,o.events?.length===1&&(h.value=o.events[0])}return(o,t)=>(a(),r("div",X,[s("div",Z,[s("div",ee,[s("button",{onClick:R,class:"p-2 hover:bg-gray-100 rounded"}," ← "),s("h2",te,u(l(b)),1),s("button",{onClick:U,class:"p-2 hover:bg-gray-100 rounded"}," → ")]),s("div",se,[s("button",{onClick:t[0]||(t[0]=e=>i.value="month"),class:f([l(i)==="month"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600","px-3 py-1.5 rounded text-sm font-medium"])}," Месяц ",2),s("button",{onClick:t[1]||(t[1]=e=>i.value="week"),class:f([l(i)==="week"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600","px-3 py-1.5 rounded text-sm font-medium"])}," Неделя ",2),s("button",{onClick:t[2]||(t[2]=e=>i.value="day"),class:f([l(i)==="day"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600","px-3 py-1.5 rounded text-sm font-medium"])}," День ",2),s("button",{onClick:z,class:"px-3 py-1.5 bg-gray-100 text-gray-600 rounded text-sm font-medium hover:bg-gray-200"}," Сегодня ")])]),l(i)==="month"?(a(),r("div",ne,[s("div",oe,[(a(),r($,null,S(T,e=>s("div",{key:e,class:"bg-gray-50 p-2 text-center text-sm font-medium text-gray-700"},u(e),1)),64))]),s("div",ae,[(a(!0),r($,null,S(l(d),e=>(a(),r("div",{key:e.date.toString(),onClick:v=>B(e),class:f(["min-h-[100px] p-2 bg-white hover:bg-gray-50 cursor-pointer",e.currentMonth?"":"bg-gray-50 text-gray-400",e.isToday?"bg-blue-50":""])},[s("div",le,[s("span",{class:f(["text-sm font-medium w-7 h-7 flex items-center justify-center rounded-full",e.isToday?"bg-blue-600 text-white":""])},u(e.day),3),e.eventsCount?(a(),r("span",ie,u(e.eventsCount)+" задач ",1)):w("",!0)]),s("div",de,[(a(!0),r($,null,S(e.events?.slice(0,3),v=>(a(),r("div",{key:v.id,class:"text-xs p-1 rounded truncate text-white",style:V({backgroundColor:v.color}),title:v.title},u(v.title),13,ce))),128)),e.events?.length>3?(a(),r("div",ue," +"+u(e.events.length-3)+" ещё ",1)):w("",!0)])],10,re))),128))])])):l(i)==="week"?(a(),r("div",ge,[s("div",ve,[t[6]||(t[6]=s("div",{class:"bg-gray-50 p-2"},null,-1)),(a(!0),r($,null,S(l(k),e=>(a(),r("div",{key:e.date.toString(),class:f(["p-2 text-center",e.isToday?"bg-blue-50":"bg-gray-50"])},[s("div",ye,u(e.weekday),1),s("div",{class:f(["text-lg font-bold",e.isToday?"text-blue-600":"text-gray-900"])},u(e.day),3)],2))),128))])])):l(i)==="day"?(a(),r("div",me,[s("h3",he,u(l(m).toLocaleDateString("ru-RU",{weekday:"long",day:"numeric",month:"long"})),1),s("div",xe,[(a(!0),r($,null,S(l(_),e=>(a(),r("div",{key:e.id,class:"p-3 rounded-lg border-l-4",style:V({borderColor:e.color,backgroundColor:e.color+"20"})},[s("div",fe,u(e.title),1),s("div",be,u(e.description),1)],4))),128)),l(_).length?w("",!0):(a(),r("div",_e," Нет задач на этот день "))])])):w("",!0),l(h)?(a(),r("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t[5]||(t[5]=e=>h.value=null)},[s("div",{class:"bg-white rounded-lg p-6 w-full max-w-md",onClick:t[4]||(t[4]=I(()=>{},["stop"]))},[s("h3",pe,u(l(h).title),1),s("p",we,u(l(h).description),1),s("div",De,[s("button",{onClick:t[3]||(t[3]=e=>h.value=null),class:"btn-secondary"}," Закрыть ")])])])):w("",!0)]))}}),Ce=Object.assign(ke,{__name:"CalendarView"}),$e={class:"min-h-screen bg-gray-50"},Se={class:"bg-white shadow-sm border-b"},Me={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},Te={class:"flex justify-between items-center h-16"},je={class:"flex items-center space-x-4"},Fe={class:"flex items-center space-x-4"},Le={key:0,class:"text-sm text-gray-600"},Ve={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},Ne={key:0,class:"flex justify-center items-center h-64"},Be=N({__name:"index",setup(L){const{user:M,logout:i}=Q(),n=D([]),m=D(!0);P(async()=>{await h()});const h=async()=>{m.value=!0;try{const b=W(),d=new Date,k=new Date(d.getFullYear(),d.getMonth()-1,1),_=new Date(d.getFullYear(),d.getMonth()+1,0),p=await $fetch(`/api/calendar?start=${k.toISOString()}&end=${_.toISOString()}`,{headers:{Authorization:`Bearer ${b.token}`}});n.value=p.data}catch(b){console.error("Failed to fetch calendar events:",b)}finally{m.value=!1}},T=async()=>{await i()};return(b,d)=>{const k=Y,_=Ce;return a(),r("div",$e,[s("header",Se,[s("div",Me,[s("div",Te,[s("div",je,[q(k,{to:"/",class:"text-blue-600 hover:underline"},{default:G(()=>[...d[1]||(d[1]=[K("← Назад",-1)])]),_:1}),d[2]||(d[2]=s("h1",{class:"text-xl font-bold text-gray-900"},"Календарь",-1))]),s("div",Fe,[l(M)?(a(),r("span",Le,u(l(M).name),1)):w("",!0),s("button",{onClick:T,class:"text-sm text-gray-600 hover:text-gray-900"}," Выйти ")])])])]),s("main",Ve,[l(m)?(a(),r("div",Ne,[...d[3]||(d[3]=[s("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1)])])):(a(),H(_,{key:1,events:l(n),"onUpdate:events":d[0]||(d[0]=p=>J(n)?n.value=p:null)},null,8,["events"]))])])}}});export{Be as default};
