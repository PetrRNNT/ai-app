{"file":"index-BB9aikaz.js","mappings":"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","names":["_ssrRenderAttrs","_mergeProps","_unref","_ssrRenderList","_ssrInterpolate","_ssrRenderAttr","_ssrIncludeBooleanAttr","_ssrLooseContain","_ssrLooseEqual","_push","_parent"],"sources":["../../../../../../../stores/automation.ts","../../../../../../../composables/useAutomation.ts","../../../../../../../components/automation/AutomationList.vue","../../../../../../../pages/automations/index.vue"],"sourcesContent":["import { defineStore } from 'pinia'\n\ninterface Automation {\n  id: string\n  name: string\n  description?: string\n  isActive: boolean\n  trigger: any\n  actions: any[]\n  userId: string\n  lastRun?: string | null\n  createdAt: string\n  updatedAt: string\n}\n\ninterface AutomationState {\n  automations: Automation[]\n  loading: boolean\n  error: string | null\n}\n\nexport const useAutomationStore = defineStore('automation', {\n  state: (): AutomationState => ({\n    automations: [],\n    loading: false,\n    error: null,\n  }),\n\n  getters: {\n    activeAutomations: (state) => state.automations.filter((a) => a.isActive),\n  },\n\n  actions: {\n    async fetchAutomations() {\n      this.loading = true\n      this.error = null\n      try {\n        const authStore = useAuthStore()\n        const data: any = await $fetch('/api/automations', {\n          headers: { Authorization: `Bearer ${authStore.token}` },\n        })\n        this.automations = data.data\n      } catch (error: any) {\n        this.error = error.message\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async createAutomation(data: any) {\n      this.loading = true\n      this.error = null\n      try {\n        const authStore = useAuthStore()\n        const result: any = await $fetch('/api/automations', {\n          method: 'POST',\n          headers: {\n            Authorization: `Bearer ${authStore.token}`,\n            'Content-Type': 'application/json',\n          },\n          body: data,\n        })\n        this.automations.push(result.data)\n        return result.data\n      } catch (error: any) {\n        this.error = error.message\n        throw error\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async deleteAutomation(id: string) {\n      try {\n        const authStore = useAuthStore()\n        await $fetch(`/api/automations/${id}`, {\n          method: 'DELETE',\n          headers: { Authorization: `Bearer ${authStore.token}` },\n        })\n        this.automations = this.automations.filter((a) => a.id !== id)\n      } catch (error: any) {\n        this.error = error.message\n        throw error\n      }\n    },\n\n    async toggleAutomation(id: string, isActive: boolean) {\n      const authStore = useAuthStore()\n      const result: any = await $fetch(`/api/automations/${id}`, {\n        method: 'PUT',\n        headers: {\n          Authorization: `Bearer ${authStore.token}`,\n          'Content-Type': 'application/json',\n        },\n        body: { isActive },\n      })\n      const index = this.automations.findIndex((a) => a.id === id)\n      if (index !== -1) {\n        this.automations[index] = result.data\n      }\n      return result.data\n    },\n  },\n})\n","import { useAutomationStore } from '~/stores/automation'\n\nexport function useAutomation() {\n  const automationStore = useAutomationStore()\n\n  const fetchAutomations = async () => automationStore.fetchAutomations()\n  const createAutomation = async (data: any) => automationStore.createAutomation(data)\n  const deleteAutomation = async (id: string) => automationStore.deleteAutomation(id)\n  const toggleAutomation = async (id: string, isActive: boolean) =>\n    automationStore.toggleAutomation(id, isActive)\n\n  return {\n    automations: computed(() => automationStore.automations),\n    activeAutomations: computed(() => automationStore.activeAutomations),\n    loading: computed(() => automationStore.loading),\n    error: computed(() => automationStore.error),\n    fetchAutomations,\n    createAutomation,\n    deleteAutomation,\n    toggleAutomation,\n  }\n}\n","<template>\n  <div class=\"space-y-4\">\n    <div class=\"flex justify-between items-center\">\n      <h3 class=\"text-lg font-semibold text-gray-900\">–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è</h3>\n      <button @click=\"showCreate = true\" class=\"btn-primary text-sm\">\n        + –ù–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ\n      </button>\n    </div>\n\n    <div v-if=\"loading\" class=\"text-center py-8\">\n      <div class=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"></div>\n    </div>\n\n    <div v-else-if=\"automations.length === 0\" class=\"text-center py-8 text-gray-500\">\n      –ù–µ—Ç –ø—Ä–∞–≤–∏–ª –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ!\n    </div>\n\n    <div v-else class=\"space-y-3\">\n      <div\n        v-for=\"automation in automations\"\n        :key=\"automation.id\"\n        class=\"card flex items-center justify-between\"\n      >\n        <div class=\"flex-1\">\n          <div class=\"flex items-center gap-2 mb-1\">\n            <h4 class=\"font-semibold text-gray-900\">{{ automation.name }}</h4>\n            <span\n              :class=\"[\n                'px-2 py-0.5 rounded text-xs',\n                automation.isActive ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800',\n              ]\"\n            >\n              {{ automation.isActive ? '–ê–∫—Ç–∏–≤–Ω–æ' : '–ù–µ–∞–∫—Ç–∏–≤–Ω–æ' }}\n            </span>\n          </div>\n          <p v-if=\"automation.description\" class=\"text-sm text-gray-600 mb-2\">\n            {{ automation.description }}\n          </p>\n          <div class=\"text-xs text-gray-500\">\n            –¢—Ä–∏–≥–≥–µ—Ä: <code class=\"bg-gray-100 px-1 rounded\">{{ automation.trigger?.type }}</code>\n            ‚Ä¢ –î–µ–π—Å—Ç–≤–∏–π: {{ automation.actions?.length || 0 }}\n            <span v-if=\"automation.lastRun\" class=\"ml-2\">\n              ‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: {{ formatDate(automation.lastRun) }}\n            </span>\n          </div>\n        </div>\n        <div class=\"flex items-center gap-2\">\n          <button\n            @click=\"toggleAutomationById(automation.id, !automation.isActive)\"\n            :class=\"[\n              'px-3 py-1 rounded text-sm',\n              automation.isActive ? 'btn-secondary' : 'btn-primary',\n            ]\"\n          >\n            {{ automation.isActive ? '–û—Ç–∫–ª—é—á–∏—Ç—å' : '–í–∫–ª—é—á–∏—Ç—å' }}\n          </button>\n          <button\n            @click=\"deleteAutomationById(automation.id)\"\n            class=\"text-gray-400 hover:text-red-600 p-2\"\n          >\n            üóëÔ∏è\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <!-- Create Automation Modal -->\n    <div\n      v-if=\"showCreate\"\n      class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\"\n      @click=\"showCreate = false\"\n    >\n      <div class=\"bg-white rounded-lg p-6 w-full max-w-lg\" @click.stop>\n        <h3 class=\"text-lg font-semibold mb-4\">–ù–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏</h3>\n        <form @submit.prevent=\"saveAutomation\">\n          <input\n            v-model=\"newAutomation.name\"\n            type=\"text\"\n            placeholder=\"–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞\"\n            class=\"input-base mb-4\"\n            required\n          />\n          <textarea\n            v-model=\"newAutomation.description\"\n            placeholder=\"–û–ø–∏—Å–∞–Ω–∏–µ\"\n            class=\"input-base mb-4\"\n            rows=\"2\"\n          ></textarea>\n\n          <!-- Trigger -->\n          <div class=\"mb-4\">\n            <label class=\"block text-sm font-medium text-gray-700 mb-2\">–¢—Ä–∏–≥–≥–µ—Ä</label>\n            <select v-model=\"newAutomation.triggerType\" class=\"input-base mb-2\">\n              <option value=\"task.created\">–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏</option>\n              <option value=\"task.completed\">–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏</option>\n              <option value=\"task.dueSoon\">–ö–æ–≥–¥–∞ –∑–∞–¥–∞—á–∞ —Å–∫–æ—Ä–æ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞</option>\n            </select>\n          </div>\n\n          <!-- Actions -->\n          <div class=\"mb-4\">\n            <label class=\"block text-sm font-medium text-gray-700 mb-2\">–î–µ–π—Å—Ç–≤–∏—è</label>\n            <div class=\"space-y-2\">\n              <div v-for=\"(action, index) in newAutomation.actions\" :key=\"index\" class=\"flex gap-2\">\n                <select v-model=\"action.type\" class=\"input-base text-sm flex-1\">\n                  <option value=\"task.updateStatus\">–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏</option>\n                  <option value=\"task.addTag\">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥</option>\n                  <option value=\"notification.send\">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</option>\n                </select>\n                <button\n                  type=\"button\"\n                  @click=\"newAutomation.actions.splice(index, 1)\"\n                  class=\"text-red-600 hover:text-red-800\"\n                >\n                  ‚úï\n                </button>\n              </div>\n              <button\n                type=\"button\"\n                @click=\"newAutomation.actions.push({ type: 'task.updateStatus' })\"\n                class=\"text-blue-600 hover:text-blue-800 text-sm\"\n              >\n                + –î–æ–±–∞–≤–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ\n              </button>\n            </div>\n          </div>\n\n          <div class=\"flex justify-end gap-2\">\n            <button type=\"button\" @click=\"showCreate = false\" class=\"btn-secondary\">–û—Ç–º–µ–Ω–∞</button>\n            <button type=\"submit\" class=\"btn-primary\">–°–æ–∑–¥–∞—Ç—å</button>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nconst { automations, loading, fetchAutomations, createAutomation, deleteAutomation, toggleAutomation } = useAutomation()\n\nconst showCreate = ref(false)\nconst newAutomation = ref({\n  name: '',\n  description: '',\n  triggerType: 'task.created',\n  actions: [{ type: 'task.updateStatus' }] as any[],\n})\n\nonMounted(async () => {\n  await fetchAutomations()\n})\n\nconst saveAutomation = async () => {\n  await createAutomation({\n    name: newAutomation.value.name,\n    description: newAutomation.value.description,\n    trigger: { type: newAutomation.value.triggerType },\n    actions: newAutomation.value.actions,\n  })\n  showCreate.value = false\n  newAutomation.value = {\n    name: '',\n    description: '',\n    triggerType: 'task.created',\n    actions: [{ type: 'task.updateStatus' }],\n  }\n}\n\nconst deleteAutomationById = async (id: string) => {\n  if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ?')) {\n    await deleteAutomation(id)\n  }\n}\n\nconst toggleAutomationById = async (id: string, isActive: boolean) => {\n  await toggleAutomation(id, isActive)\n}\n\nconst formatDate = (dateString: string) => {\n  return new Date(dateString).toLocaleDateString('ru-RU', {\n    day: 'numeric',\n    month: 'short',\n    hour: '2-digit',\n    minute: '2-digit',\n  })\n}\n</script>\n","<template>\n  <div class=\"min-h-screen bg-gray-50\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n      <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div class=\"flex justify-between items-center h-16\">\n          <div class=\"flex items-center space-x-4\">\n            <NuxtLink to=\"/\" class=\"text-blue-600 hover:underline\">‚Üê –ù–∞–∑–∞–¥</NuxtLink>\n            <h1 class=\"text-xl font-bold text-gray-900\">–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è</h1>\n          </div>\n\n          <div class=\"flex items-center space-x-4\">\n            <span v-if=\"user\" class=\"text-sm text-gray-600\">{{ user.name }}</span>\n            <button @click=\"handleLogout\" class=\"text-sm text-gray-600 hover:text-gray-900\">\n              –í—ã–π—Ç–∏\n            </button>\n          </div>\n        </div>\n      </div>\n    </header>\n\n    <!-- Main Content -->\n    <main class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n      <AutomationList />\n    </main>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\ndefinePageMeta({\n  middleware: ['auth'],\n})\n\nconst { user, logout } = useAuth()\n\nconst handleLogout = async () => {\n  await logout()\n}\n</script>\n"],"version":3}