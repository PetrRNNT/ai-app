import { _ as __nuxt_component_0 } from "./nuxt-link-xjMrTn-4.js";
import { defineComponent, useModel, ref, computed, mergeProps, unref, useSSRContext, withCtx, createTextVNode, isRef } from "vue";
import { ssrRenderAttrs, ssrInterpolate, ssrRenderClass, ssrRenderList, ssrRenderStyle, ssrRenderAttr, ssrRenderComponent } from "vue/server-renderer";
import "C:/Users/ipetr/Documents/todo-qwen-ai/todo-app/node_modules/nuxt/node_modules/hookable/dist/index.mjs";
import { u as useAuth } from "./useAuth-BbwPNOMF.js";
import "../server.mjs";
import "C:/Users/ipetr/Documents/todo-qwen-ai/todo-app/node_modules/ufo/dist/index.mjs";
import "C:/Users/ipetr/Documents/todo-qwen-ai/todo-app/node_modules/ofetch/dist/node.mjs";
import "#internal/nuxt/paths";
import "C:/Users/ipetr/Documents/todo-qwen-ai/todo-app/node_modules/unctx/dist/index.mjs";
import "C:/Users/ipetr/Documents/todo-qwen-ai/todo-app/node_modules/h3/dist/index.mjs";
import "pinia";
import "C:/Users/ipetr/Documents/todo-qwen-ai/todo-app/node_modules/defu/dist/defu.mjs";
import "vue-router";
import "C:/Users/ipetr/Documents/todo-qwen-ai/todo-app/node_modules/klona/dist/index.mjs";
const _sfc_main$1 = /* @__PURE__ */ defineComponent({
  __name: "CalendarView",
  __ssrInlineRender: true,
  props: {
    "events": { default: () => [] },
    "eventsModifiers": {}
  },
  emits: ["update:events"],
  setup(__props) {
    const events = useModel(__props, "events");
    const view = ref("month");
    const currentDate = ref(/* @__PURE__ */ new Date());
    const selectedDate = ref(/* @__PURE__ */ new Date());
    const selectedEvent = ref(null);
    const weekdayNames = ["Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Вс"];
    const currentPeriodLabel = computed(() => {
      if (view.value === "month") {
        return currentDate.value.toLocaleDateString("ru-RU", { month: "long", year: "numeric" });
      } else if (view.value === "week") {
        const start = getWeekStart(currentDate.value);
        const end = new Date(start);
        end.setDate(end.getDate() + 6);
        return `${start.toLocaleDateString("ru-RU", { day: "numeric", month: "short" })} - ${end.toLocaleDateString("ru-RU", { day: "numeric", month: "short", year: "numeric" })}`;
      }
      return currentDate.value.toLocaleDateString("ru-RU", { day: "numeric", month: "long", year: "numeric" });
    });
    const calendarDays = computed(() => {
      const year = currentDate.value.getFullYear();
      const month = currentDate.value.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const days = [];
      const today = /* @__PURE__ */ new Date();
      const startDayOfWeek = firstDay.getDay() || 7;
      for (let i = startDayOfWeek - 1; i > 0; i--) {
        const day = new Date(year, month, -i + 1);
        days.push({
          day: day.getDate(),
          date: day,
          currentMonth: false,
          isToday: isSameDay(day, today),
          events: getEventsForDay(day),
          eventsCount: getEventsForDay(day).length
        });
      }
      for (let i = 1; i <= lastDay.getDate(); i++) {
        const day = new Date(year, month, i);
        days.push({
          day: i,
          date: day,
          currentMonth: true,
          isToday: isSameDay(day, today),
          events: getEventsForDay(day),
          eventsCount: getEventsForDay(day).length
        });
      }
      const remainingDays = 42 - days.length;
      for (let i = 1; i <= remainingDays; i++) {
        const day = new Date(year, month + 1, i);
        days.push({
          day: i,
          date: day,
          currentMonth: false,
          isToday: isSameDay(day, today),
          events: getEventsForDay(day),
          eventsCount: getEventsForDay(day).length
        });
      }
      return days;
    });
    const weekDays = computed(() => {
      const start = getWeekStart(currentDate.value);
      const days = [];
      const today = /* @__PURE__ */ new Date();
      for (let i = 0; i < 7; i++) {
        const day = new Date(start);
        day.setDate(day.getDate() + i);
        days.push({
          day: day.getDate(),
          weekday: weekdayNames[i],
          date: day,
          isToday: isSameDay(day, today)
        });
      }
      return days;
    });
    const eventsOnSelectedDate = computed(() => {
      return getEventsForDay(selectedDate.value);
    });
    function getWeekStart(date) {
      const d = new Date(date);
      const day = d.getDay() || 7;
      d.setDate(d.getDate() - day + 1);
      return d;
    }
    function getEventsForDay(date) {
      return events.value.filter((event) => {
        const eventDate = new Date(event.start);
        return isSameDay(eventDate, date);
      });
    }
    function isSameDay(d1, d2) {
      return d1.getFullYear() === d2.getFullYear() && d1.getMonth() === d2.getMonth() && d1.getDate() === d2.getDate();
    }
    return (_ctx, _push, _parent, _attrs) => {
      _push(`<div${ssrRenderAttrs(mergeProps({ class: "card" }, _attrs))}><div class="flex justify-between items-center mb-6"><div class="flex items-center gap-4"><button class="p-2 hover:bg-gray-100 rounded"> ← </button><h2 class="text-xl font-semibold text-gray-900">${ssrInterpolate(unref(currentPeriodLabel))}</h2><button class="p-2 hover:bg-gray-100 rounded"> → </button></div><div class="flex gap-2"><button class="${ssrRenderClass([unref(view) === "month" ? "bg-blue-600 text-white" : "bg-gray-100 text-gray-600", "px-3 py-1.5 rounded text-sm font-medium"])}"> Месяц </button><button class="${ssrRenderClass([unref(view) === "week" ? "bg-blue-600 text-white" : "bg-gray-100 text-gray-600", "px-3 py-1.5 rounded text-sm font-medium"])}"> Неделя </button><button class="${ssrRenderClass([unref(view) === "day" ? "bg-blue-600 text-white" : "bg-gray-100 text-gray-600", "px-3 py-1.5 rounded text-sm font-medium"])}"> День </button><button class="px-3 py-1.5 bg-gray-100 text-gray-600 rounded text-sm font-medium hover:bg-gray-200"> Сегодня </button></div></div>`);
      if (unref(view) === "month") {
        _push(`<div class="month-view"><div class="grid grid-cols-7 gap-px bg-gray-200 border border-gray-200 rounded-lg overflow-hidden mb-2"><!--[-->`);
        ssrRenderList(weekdayNames, (day) => {
          _push(`<div class="bg-gray-50 p-2 text-center text-sm font-medium text-gray-700">${ssrInterpolate(day)}</div>`);
        });
        _push(`<!--]--></div><div class="grid grid-cols-7 gap-px bg-gray-200 border border-gray-200 rounded-lg overflow-hidden"><!--[-->`);
        ssrRenderList(unref(calendarDays), (day) => {
          _push(`<div class="${ssrRenderClass([
            "min-h-[100px] p-2 bg-white hover:bg-gray-50 cursor-pointer",
            !day.currentMonth ? "bg-gray-50 text-gray-400" : "",
            day.isToday ? "bg-blue-50" : ""
          ])}"><div class="flex justify-between items-start mb-1"><span class="${ssrRenderClass([
            "text-sm font-medium w-7 h-7 flex items-center justify-center rounded-full",
            day.isToday ? "bg-blue-600 text-white" : ""
          ])}">${ssrInterpolate(day.day)}</span>`);
          if (day.eventsCount) {
            _push(`<span class="text-xs text-gray-500">${ssrInterpolate(day.eventsCount)} задач </span>`);
          } else {
            _push(`<!---->`);
          }
          _push(`</div><div class="space-y-1"><!--[-->`);
          ssrRenderList(day.events?.slice(0, 3), (event) => {
            _push(`<div class="text-xs p-1 rounded truncate text-white" style="${ssrRenderStyle({ backgroundColor: event.color })}"${ssrRenderAttr("title", event.title)}>${ssrInterpolate(event.title)}</div>`);
          });
          _push(`<!--]-->`);
          if (day.events?.length > 3) {
            _push(`<div class="text-xs text-gray-500"> +${ssrInterpolate(day.events.length - 3)} ещё </div>`);
          } else {
            _push(`<!---->`);
          }
          _push(`</div></div>`);
        });
        _push(`<!--]--></div></div>`);
      } else if (unref(view) === "week") {
        _push(`<div class="week-view"><div class="grid grid-cols-8 gap-px bg-gray-200 border border-gray-200 rounded-lg overflow-hidden"><div class="bg-gray-50 p-2"></div><!--[-->`);
        ssrRenderList(unref(weekDays), (day) => {
          _push(`<div class="${ssrRenderClass([
            "p-2 text-center",
            day.isToday ? "bg-blue-50" : "bg-gray-50"
          ])}"><div class="text-sm font-medium text-gray-700">${ssrInterpolate(day.weekday)}</div><div class="${ssrRenderClass([
            "text-lg font-bold",
            day.isToday ? "text-blue-600" : "text-gray-900"
          ])}">${ssrInterpolate(day.day)}</div></div>`);
        });
        _push(`<!--]--></div></div>`);
      } else if (unref(view) === "day") {
        _push(`<div class="day-view p-4"><h3 class="text-lg font-semibold mb-4">${ssrInterpolate(unref(selectedDate).toLocaleDateString("ru-RU", { weekday: "long", day: "numeric", month: "long" }))}</h3><div class="space-y-2"><!--[-->`);
        ssrRenderList(unref(eventsOnSelectedDate), (event) => {
          _push(`<div class="p-3 rounded-lg border-l-4" style="${ssrRenderStyle({ borderColor: event.color, backgroundColor: event.color + "20" })}"><div class="font-medium">${ssrInterpolate(event.title)}</div><div class="text-sm text-gray-600">${ssrInterpolate(event.description)}</div></div>`);
        });
        _push(`<!--]-->`);
        if (!unref(eventsOnSelectedDate).length) {
          _push(`<div class="text-gray-500 text-center py-8"> Нет задач на этот день </div>`);
        } else {
          _push(`<!---->`);
        }
        _push(`</div></div>`);
      } else {
        _push(`<!---->`);
      }
      if (unref(selectedEvent)) {
        _push(`<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"><div class="bg-white rounded-lg p-6 w-full max-w-md"><h3 class="text-lg font-semibold mb-4">${ssrInterpolate(unref(selectedEvent).title)}</h3><p class="text-gray-600 mb-4">${ssrInterpolate(unref(selectedEvent).description)}</p><div class="flex justify-end"><button class="btn-secondary"> Закрыть </button></div></div></div>`);
      } else {
        _push(`<!---->`);
      }
      _push(`</div>`);
    };
  }
});
const _sfc_setup$1 = _sfc_main$1.setup;
_sfc_main$1.setup = (props, ctx) => {
  const ssrContext = useSSRContext();
  (ssrContext.modules || (ssrContext.modules = /* @__PURE__ */ new Set())).add("components/calendar/CalendarView.vue");
  return _sfc_setup$1 ? _sfc_setup$1(props, ctx) : void 0;
};
const __nuxt_component_1 = Object.assign(_sfc_main$1, { __name: "CalendarView" });
const _sfc_main = /* @__PURE__ */ defineComponent({
  __name: "index",
  __ssrInlineRender: true,
  setup(__props) {
    const { user } = useAuth();
    const events = ref([]);
    const loading = ref(true);
    return (_ctx, _push, _parent, _attrs) => {
      const _component_NuxtLink = __nuxt_component_0;
      const _component_CalendarView = __nuxt_component_1;
      _push(`<div${ssrRenderAttrs(mergeProps({ class: "min-h-screen bg-gray-50" }, _attrs))}><header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center space-x-4">`);
      _push(ssrRenderComponent(_component_NuxtLink, {
        to: "/",
        class: "text-blue-600 hover:underline"
      }, {
        default: withCtx((_, _push2, _parent2, _scopeId) => {
          if (_push2) {
            _push2(`← Назад`);
          } else {
            return [
              createTextVNode("← Назад")
            ];
          }
        }),
        _: 1
      }, _parent));
      _push(`<h1 class="text-xl font-bold text-gray-900">Календарь</h1></div><div class="flex items-center space-x-4">`);
      if (unref(user)) {
        _push(`<span class="text-sm text-gray-600">${ssrInterpolate(unref(user).name)}</span>`);
      } else {
        _push(`<!---->`);
      }
      _push(`<button class="text-sm text-gray-600 hover:text-gray-900"> Выйти </button></div></div></div></header><main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">`);
      if (unref(loading)) {
        _push(`<div class="flex justify-center items-center h-64"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div></div>`);
      } else {
        _push(ssrRenderComponent(_component_CalendarView, {
          events: unref(events),
          "onUpdate:events": ($event) => isRef(events) ? events.value = $event : null
        }, null, _parent));
      }
      _push(`</main></div>`);
    };
  }
});
const _sfc_setup = _sfc_main.setup;
_sfc_main.setup = (props, ctx) => {
  const ssrContext = useSSRContext();
  (ssrContext.modules || (ssrContext.modules = /* @__PURE__ */ new Set())).add("pages/calendar/index.vue");
  return _sfc_setup ? _sfc_setup(props, ctx) : void 0;
};
export {
  _sfc_main as default
};
//# sourceMappingURL=index-DfeWjINg.js.map
