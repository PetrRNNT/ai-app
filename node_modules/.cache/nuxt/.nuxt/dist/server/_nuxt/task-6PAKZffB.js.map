{"version":3,"file":"task-6PAKZffB.js","sources":["../../../../../../../stores/task.ts"],"sourcesContent":["import { defineStore } from 'pinia'\nimport type { TaskFilters, CreateTaskInput, UpdateTaskInput, TaskWithRelations } from '~/types'\n\ninterface TaskState {\n  tasks: TaskWithRelations[]\n  currentTask: TaskWithRelations | null\n  loading: boolean\n  error: string | null\n  filters: TaskFilters\n}\n\nexport const useTaskStore = defineStore('task', {\n  state: (): TaskState => ({\n    tasks: [],\n    currentTask: null,\n    loading: false,\n    error: null,\n    filters: {},\n  }),\n\n  getters: {\n    allTasks: (state) => state.tasks,\n    filteredTasks: (state: TaskState) => {\n      let filtered = state.tasks\n\n      if (state.filters.status?.length) {\n        filtered = filtered.filter((t: TaskWithRelations) => t.status && state.filters.status?.includes(t.status))\n      }\n      if (state.filters.priority?.length) {\n        filtered = filtered.filter((t: TaskWithRelations) => t.priority && state.filters.priority?.includes(t.priority))\n      }\n      if (state.filters.projectId) {\n        filtered = filtered.filter((t: TaskWithRelations) => t.projectId === state.filters.projectId)\n      }\n      if (state.filters.search) {\n        const search = state.filters.search.toLowerCase()\n        filtered = filtered.filter(\n          (t: TaskWithRelations) =>\n            t.title.toLowerCase().includes(search) ||\n            t.description?.toLowerCase().includes(search)\n        )\n      }\n      if (state.filters.isImportant !== undefined) {\n        filtered = filtered.filter((t: TaskWithRelations) => t.isImportant === state.filters.isImportant)\n      }\n\n      return filtered\n    },\n    completedTasks: (state: TaskState) => state.tasks.filter((t: TaskWithRelations) => t.status === 'COMPLETED'),\n    pendingTasks: (state: TaskState) => state.tasks.filter((t: TaskWithRelations) => t.status !== 'COMPLETED'),\n    importantTasks: (state: TaskState) => state.tasks.filter((t: TaskWithRelations) => t.isImportant),\n  },\n\n  actions: {\n    setFilters(filters: TaskFilters) {\n      this.filters = filters\n    },\n\n    clearFilters() {\n      this.filters = {}\n    },\n\n    async fetchTasks(filters?: TaskFilters) {\n      this.loading = true\n      this.error = null\n\n      try {\n        const query = filters ? new URLSearchParams(filters as any).toString() : ''\n        const url = query ? `/api/tasks?${query}` : '/api/tasks'\n\n        const authStore = useAuthStore()\n        const token = authStore.validToken\n        if (!token) throw new Error('Not authenticated')\n        \n        const data: any = await $fetch(url, {\n          headers: {\n            Authorization: `Bearer ${token}`,\n          },\n        })\n\n        this.tasks = data.data\n      } catch (error: any) {\n        this.error = error.message || 'Failed to fetch tasks'\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async fetchTaskById(id: string) {\n      this.loading = true\n      this.error = null\n\n      try {\n        const authStore = useAuthStore()\n        const token = authStore.validToken\n        if (!token) throw new Error('Not authenticated')\n        \n        const data: any = await $fetch(`/api/tasks/${id}`, {\n          headers: {\n            Authorization: `Bearer ${token}`,\n          },\n        })\n\n        this.currentTask = data.data\n        return data.data\n      } catch (error: any) {\n        this.error = error.message || 'Failed to fetch task'\n        throw error\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async createTask(data: CreateTaskInput) {\n      this.loading = true\n      this.error = null\n\n      try {\n        const authStore = useAuthStore()\n        \n        const token = authStore.validToken\n        if (!token) {\n          throw new Error('Not authenticated. Please log in again.')\n        }\n        \n        const result: any = await $fetch('/api/tasks', {\n          method: 'POST',\n          headers: {\n            Authorization: `Bearer ${token}`,\n            'Content-Type': 'application/json',\n          },\n          body: data,\n        })\n\n        this.tasks.push(result.data)\n        return result.data\n      } catch (error: any) {\n        this.error = error.message || 'Failed to create task'\n        throw error\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async updateTask(data: UpdateTaskInput) {\n      this.loading = true\n      this.error = null\n\n      try {\n        const authStore = useAuthStore()\n        const token = authStore.validToken\n        if (!token) throw new Error('Not authenticated')\n        \n        const { id, ...updateData } = data\n        const result: any = await $fetch(`/api/tasks/${id}`, {\n          method: 'PUT',\n          headers: {\n            Authorization: `Bearer ${token}`,\n            'Content-Type': 'application/json',\n          },\n          body: updateData,\n        })\n\n        const index = this.tasks.findIndex((t: TaskWithRelations) => t.id === id)\n        if (index !== -1) {\n          this.tasks[index] = result.data\n        }\n\n        if (this.currentTask?.id === id) {\n          this.currentTask = result.data\n        }\n\n        return result.data\n      } catch (error: any) {\n        this.error = error.message || 'Failed to update task'\n        throw error\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async deleteTask(id: string) {\n      this.loading = true\n      this.error = null\n\n      try {\n        const authStore = useAuthStore()\n        const token = authStore.validToken\n        if (!token) throw new Error('Not authenticated')\n        \n        await $fetch(`/api/tasks/${id}`, {\n          method: 'DELETE',\n          headers: {\n            Authorization: `Bearer ${token}`,\n          },\n        })\n\n        this.tasks = this.tasks.filter((t: TaskWithRelations) => t.id !== id)\n      } catch (error: any) {\n        this.error = error.message || 'Failed to delete task'\n        throw error\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async completeTask(id: string) {\n      this.loading = true\n      this.error = null\n\n      try {\n        const authStore = useAuthStore()\n        const token = authStore.validToken\n        if (!token) throw new Error('Not authenticated')\n        \n        const result: any = await $fetch(`/api/tasks/${id}/complete`, {\n          method: 'POST',\n          headers: {\n            Authorization: `Bearer ${token}`,\n          },\n        })\n\n        const index = this.tasks.findIndex((t: TaskWithRelations) => t.id === id)\n        if (index !== -1) {\n          this.tasks[index] = result.data\n        }\n\n        return result.data\n      } catch (error: any) {\n        this.error = error.message || 'Failed to complete task'\n        throw error\n      } finally {\n        this.loading = false\n      }\n    },\n  },\n})\n"],"names":[],"mappings":"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"}