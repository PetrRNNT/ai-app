{"version":3,"file":"index-Ifz0Hb9C.js","sources":["../../../../../../../components/analytics/Dashboard.vue","../../../../../../../stores/analytics.ts","../../../../../../../composables/useAnalytics.ts","../../../../../../../pages/analytics/index.vue"],"sourcesContent":["<template>\n  <div class=\"space-y-6\">\n    <!-- Stats Cards -->\n    <div class=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n      <div class=\"card\">\n        <div class=\"text-sm text-gray-500 mb-1\">Всего задач</div>\n        <div class=\"text-3xl font-bold text-gray-900\">{{ stats?.totalTasks || 0 }}</div>\n      </div>\n      <div class=\"card\">\n        <div class=\"text-sm text-gray-500 mb-1\">Завершено</div>\n        <div class=\"text-3xl font-bold text-green-600\">{{ stats?.completedTasks || 0 }}</div>\n      </div>\n      <div class=\"card\">\n        <div class=\"text-sm text-gray-500 mb-1\">Процент завершения</div>\n        <div class=\"text-3xl font-bold text-blue-600\">{{ stats?.completionRate || 0 }}%</div>\n      </div>\n      <div class=\"card\">\n        <div class=\"text-sm text-gray-500 mb-1\">Ср. время выполнения</div>\n        <div class=\"text-3xl font-bold text-purple-600\">{{ stats?.avgCompletionTime || 0 }}ч</div>\n      </div>\n    </div>\n\n    <!-- Charts Row 1 -->\n    <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n      <!-- Tasks by Status -->\n      <div class=\"card\">\n        <h3 class=\"text-lg font-semibold text-gray-900 mb-4\">Задачи по статусам</h3>\n        <div class=\"space-y-3\">\n          <div\n            v-for=\"(count, status) in stats?.tasksByStatus\"\n            :key=\"status\"\n            class=\"flex items-center justify-between\"\n          >\n            <span class=\"text-sm text-gray-600\">{{ getStatusLabel(status) }}</span>\n            <div class=\"flex items-center gap-3\">\n              <div class=\"w-32 bg-gray-200 rounded-full h-2\">\n                <div\n                  class=\"h-2 rounded-full\"\n                  :class=\"getStatusColor(status)\"\n                  :style=\"{ width: `${getPercentage(count, stats?.totalTasks)}%` }\"\n                ></div>\n              </div>\n              <span class=\"text-sm font-medium text-gray-900 w-8 text-right\">{{ count }}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Tasks by Priority -->\n      <div class=\"card\">\n        <h3 class=\"text-lg font-semibold text-gray-900 mb-4\">Задачи по приоритетам</h3>\n        <div class=\"space-y-3\">\n          <div\n            v-for=\"(count, priority) in stats?.tasksByPriority\"\n            :key=\"priority\"\n            class=\"flex items-center justify-between\"\n          >\n            <span class=\"text-sm text-gray-600\">{{ getPriorityLabel(priority) }}</span>\n            <div class=\"flex items-center gap-3\">\n              <div class=\"w-32 bg-gray-200 rounded-full h-2\">\n                <div\n                  class=\"h-2 rounded-full\"\n                  :class=\"getPriorityColor(priority)\"\n                  :style=\"{ width: `${getPercentage(count, stats?.totalTasks)}%` }\"\n                ></div>\n              </div>\n              <span class=\"text-sm font-medium text-gray-900 w-8 text-right\">{{ count }}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- Tasks Completed by Day -->\n    <div class=\"card\">\n      <h3 class=\"text-lg font-semibold text-gray-900 mb-4\">Завершено задач за последние 7 дней</h3>\n      <div class=\"h-48 flex items-end justify-between gap-2\">\n        <div\n          v-for=\"(day, index) in stats?.tasksCompletedByDay\"\n          :key=\"index\"\n          class=\"flex-1 flex flex-col items-center gap-2\"\n        >\n          <div\n            class=\"w-full bg-blue-500 rounded-t transition-all hover:bg-blue-600\"\n            :style=\"{ height: `${getBarHeight(day.count)}%` }\"\n          ></div>\n          <span class=\"text-xs text-gray-600\">{{ day.date }}</span>\n        </div>\n      </div>\n    </div>\n\n    <!-- Time Tracking -->\n    <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n      <div class=\"card\">\n        <h3 class=\"text-lg font-semibold text-gray-900 mb-4\">Учёт времени</h3>\n        <div class=\"text-center py-8\">\n          <div class=\"text-4xl font-bold text-blue-600 mb-2\">\n            {{ formatTime(stats?.timeTracked || 0) }}\n          </div>\n          <p class=\"text-sm text-gray-500\">всего отслежено за 30 дней</p>\n        </div>\n      </div>\n\n      <div class=\"card\">\n        <h3 class=\"text-lg font-semibold text-gray-900 mb-4\">План vs Факт</h3>\n        <div class=\"space-y-4\">\n          <div>\n            <div class=\"flex justify-between text-sm mb-1\">\n              <span class=\"text-gray-600\">Оценено</span>\n              <span class=\"font-medium\">{{ formatTime(stats?.estimatedVsActual?.estimated || 0) }}</span>\n            </div>\n            <div class=\"w-full bg-gray-200 rounded-full h-3\">\n              <div\n                class=\"bg-blue-500 h-3 rounded-full\"\n                :style=\"{ width: getEstimatedPercentage() }\"\n              ></div>\n            </div>\n          </div>\n          <div>\n            <div class=\"flex justify-between text-sm mb-1\">\n              <span class=\"text-gray-600\">Фактически</span>\n              <span class=\"font-medium\">{{ formatTime(stats?.estimatedVsActual?.actual || 0) }}</span>\n            </div>\n            <div class=\"w-full bg-gray-200 rounded-full h-3\">\n              <div\n                class=\"bg-green-500 h-3 rounded-full\"\n                :style=\"{ width: getActualPercentage() }\"\n              ></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nconst props = defineProps<{\n  stats: any\n}>()\n\nconst getStatusLabel = (status: string) => {\n  const labels: Record<string, string> = {\n    NEW: 'Новые',\n    IN_PROGRESS: 'В процессе',\n    PAUSED: 'На паузе',\n    WAITING: 'Ожидание',\n    COMPLETED: 'Завершено',\n    CANCELLED: 'Отменено',\n    ARCHIVED: 'Архив',\n  }\n  return labels[status] || status\n}\n\nconst getStatusColor = (status: string) => {\n  const colors: Record<string, string> = {\n    NEW: 'bg-blue-500',\n    IN_PROGRESS: 'bg-yellow-500',\n    PAUSED: 'bg-gray-500',\n    WAITING: 'bg-purple-500',\n    COMPLETED: 'bg-green-500',\n    CANCELLED: 'bg-red-500',\n    ARCHIVED: 'bg-gray-400',\n  }\n  return colors[status] || 'bg-gray-500'\n}\n\nconst getPriorityLabel = (priority: string) => {\n  const labels: Record<string, string> = {\n    CRITICAL: 'Критичный',\n    HIGH: 'Высокий',\n    MEDIUM: 'Средний',\n    LOW: 'Низкий',\n    NONE: 'Без приоритета',\n  }\n  return labels[priority] || priority\n}\n\nconst getPriorityColor = (priority: string) => {\n  const colors: Record<string, string> = {\n    CRITICAL: 'bg-red-600',\n    HIGH: 'bg-red-500',\n    MEDIUM: 'bg-yellow-500',\n    LOW: 'bg-green-500',\n    NONE: 'bg-gray-400',\n  }\n  return colors[priority] || 'bg-gray-500'\n}\n\nconst getPercentage = (value: number, total: number) => {\n  if (!total) return 0\n  return Math.round((value / total) * 100)\n}\n\nconst getBarHeight = (count: number) => {\n  const maxCount = Math.max(...(props.stats?.tasksCompletedByDay?.map((d: any) => d.count) || [1]))\n  if (!maxCount) return 0\n  return Math.max(10, (count / maxCount) * 100)\n}\n\nconst formatTime = (seconds: number) => {\n  const hours = Math.floor(seconds / 3600)\n  const minutes = Math.floor((seconds % 3600) / 60)\n  if (hours > 0) {\n    return `${hours}ч ${minutes}м`\n  }\n  return `${minutes}м`\n}\n\nconst getMaxTime = () => {\n  const estimated = props.stats?.estimatedVsActual?.estimated || 0\n  const actual = props.stats?.estimatedVsActual?.actual || 0\n  return Math.max(estimated, actual, 1)\n}\n\nconst getEstimatedPercentage = () => {\n  const max = getMaxTime()\n  const estimated = props.stats?.estimatedVsActual?.estimated || 0\n  return `${(estimated / max) * 100}%`\n}\n\nconst getActualPercentage = () => {\n  const max = getMaxTime()\n  const actual = props.stats?.estimatedVsActual?.actual || 0\n  return `${(actual / max) * 100}%`\n}\n</script>\n","import { defineStore } from 'pinia'\n\ninterface AnalyticsState {\n  stats: any | null\n  loading: boolean\n  error: string | null\n}\n\nexport const useAnalyticsStore = defineStore('analytics', {\n  state: (): AnalyticsState => ({\n    stats: null,\n    loading: false,\n    error: null,\n  }),\n\n  getters: {\n    productivityStats: (state) => state.stats,\n  },\n\n  actions: {\n    async fetchStats() {\n      this.loading = true\n      this.error = null\n\n      try {\n        const authStore = useAuthStore()\n        const data: any = await $fetch('/api/analytics', {\n          headers: {\n            Authorization: `Bearer ${authStore.token}`,\n          },\n        })\n\n        this.stats = data.data\n      } catch (error: any) {\n        this.error = error.message || 'Failed to fetch analytics'\n      } finally {\n        this.loading = false\n      }\n    },\n  },\n})\n","import { useAnalyticsStore } from '~/stores/analytics'\n\nexport function useAnalytics() {\n  const analyticsStore = useAnalyticsStore()\n\n  const fetchStats = async () => {\n    return analyticsStore.fetchStats()\n  }\n\n  return {\n    stats: computed(() => analyticsStore.stats),\n    loading: computed(() => analyticsStore.loading),\n    error: computed(() => analyticsStore.error),\n    fetchStats,\n  }\n}\n","<template>\n  <div class=\"min-h-screen bg-gray-50\">\n    <!-- Header -->\n    <header class=\"bg-white shadow-sm border-b\">\n      <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div class=\"flex justify-between items-center h-16\">\n          <div class=\"flex items-center space-x-4\">\n            <NuxtLink to=\"/\" class=\"text-blue-600 hover:underline\">← Назад</NuxtLink>\n            <h1 class=\"text-xl font-bold text-gray-900\">Аналитика</h1>\n          </div>\n\n          <div class=\"flex items-center space-x-4\">\n            <span v-if=\"user\" class=\"text-sm text-gray-600\">{{ user.name }}</span>\n            <button @click=\"handleLogout\" class=\"text-sm text-gray-600 hover:text-gray-900\">\n              Выйти\n            </button>\n          </div>\n        </div>\n      </div>\n    </header>\n\n    <!-- Main Content -->\n    <main class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n      <div v-if=\"loading\" class=\"flex justify-center items-center h-64\">\n        <div class=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n      </div>\n\n      <Dashboard v-else :stats=\"stats\" />\n    </main>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Dashboard from '~/components/analytics/Dashboard.vue'\n\ndefinePageMeta({\n  middleware: ['auth'],\n})\n\nconst { user, logout } = useAuth()\nconst { stats, loading, fetchStats } = useAnalytics()\n\nonMounted(async () => {\n  await fetchStats()\n})\n\nconst handleLogout = async () => {\n  await logout()\n}\n</script>\n"],"names":["_ssrRenderAttrs","_mergeProps","_ssrInterpolate","_ssrRenderList","_ssrRenderClass","_ssrRenderStyle","_push","_parent","_unref","_ssrRenderComponent"],"mappings":"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"}