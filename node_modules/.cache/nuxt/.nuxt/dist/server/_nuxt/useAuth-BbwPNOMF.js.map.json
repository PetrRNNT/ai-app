{"file":"useAuth-BbwPNOMF.js","mappings":";;AAEA,IAAI,cAAoC;AAEjC,SAAS,UAAU;AACxB,QAAM,YAAY,aAAA;AAGlB,QAAM,aAAa,YAAY;AAC7B,QAAI,CAAC,aAAa;AAChB,oBAAc,UAAU,SAAA;AAAA,IAC1B;AACA,UAAM;AAAA,EACR;AAEA,QAAM,QAAQ,OAAO,OAAe,aAAqB;AACvD,UAAM,WAAA;AACN,cAAU,WAAW,IAAI;AACzB,QAAI;AACF,YAAM,OAAY,MAAM,OAAO,aAAa;AAAA,QAC1C,QAAQ;AAAA,QACR,MAAM,EAAE,OAAO,SAAA;AAAA,MAAS,CACzB;AAED,gBAAU,QAAQ,KAAK,MAAM,KAAK,KAAK;AACvC,aAAO,EAAE,SAAS,KAAA;AAAA,IACpB,SAAS,OAAY;AACnB,gBAAU,WAAW,KAAK;AAC1B,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO,MAAM,WAAW;AAAA,MAAA;AAAA,IAE5B;AAAA,EACF;AAEA,QAAM,WAAW,OAAO,OAAe,MAAc,aAAqB;AACxE,UAAM,WAAA;AACN,cAAU,WAAW,IAAI;AACzB,QAAI;AACF,YAAM,OAAY,MAAM,OAAO,aAAa;AAAA,QAC1C,QAAQ;AAAA,QACR,MAAM,EAAE,OAAO,MAAM,SAAA;AAAA,MAAS,CAC/B;AAED,gBAAU,QAAQ,KAAK,MAAM,KAAK,KAAK;AACvC,aAAO,EAAE,SAAS,KAAA;AAAA,IACpB,SAAS,OAAY;AACnB,gBAAU,WAAW,KAAK;AAC1B,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO,MAAM,WAAW;AAAA,MAAA;AAAA,IAE5B;AAAA,EACF;AAEA,QAAM,SAAS,YAAY;AACzB,UAAM,UAAU,OAAA;AAChB,eAAW,QAAQ;AAAA,EACrB;AAEA,QAAM,cAAc,YAAY;AAC9B,UAAM,WAAA;AACN,WAAO,UAAU,UAAA;AAAA,EACnB;AAEA,QAAM,sBAAsB,YAAY;AACtC,UAAM,WAAA;AACN,QAAI,CAAC,UAAU,mBAAmB,CAAC,UAAU,OAAO;AAClD,YAAM,IAAI,MAAM,mBAAmB;AAAA,IACrC;AACA,WAAO,UAAU;AAAA,EACnB;AAEA,SAAO;AAAA,IACL,MAAM,SAAS,MAAM,UAAU,IAAI;AAAA,IACnC,iBAAiB,SAAS,MAAM,UAAU,eAAe;AAAA,IACzD,SAAS,SAAS,MAAM,UAAU,OAAO;AAAA,IACzC,UAAU,SAAS,MAAM,UAAU,QAAQ;AAAA,IAC3C;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ;","names":[],"sources":["../../../../../../../composables/useAuth.ts"],"sourcesContent":["import { useAuthStore } from '~/stores/auth'\n\nlet initPromise: Promise<void> | null = null\n\nexport function useAuth() {\n  const authStore = useAuthStore()\n\n  // Ensure auth is initialized\n  const ensureInit = async () => {\n    if (!initPromise) {\n      initPromise = authStore.initAuth()\n    }\n    await initPromise\n  }\n\n  const login = async (email: string, password: string) => {\n    await ensureInit()\n    authStore.setLoading(true)\n    try {\n      const data: any = await $fetch('/api/auth', {\n        method: 'POST',\n        body: { email, password },\n      })\n\n      authStore.setAuth(data.data, data.token)\n      return { success: true }\n    } catch (error: any) {\n      authStore.setLoading(false)\n      return {\n        success: false,\n        error: error.message || 'Login failed',\n      }\n    }\n  }\n\n  const register = async (email: string, name: string, password: string) => {\n    await ensureInit()\n    authStore.setLoading(true)\n    try {\n      const data: any = await $fetch('/api/auth', {\n        method: 'POST',\n        body: { email, name, password },\n      })\n\n      authStore.setAuth(data.data, data.token)\n      return { success: true }\n    } catch (error: any) {\n      authStore.setLoading(false)\n      return {\n        success: false,\n        error: error.message || 'Registration failed',\n      }\n    }\n  }\n\n  const logout = async () => {\n    await authStore.logout()\n    navigateTo('/login')\n  }\n\n  const refreshUser = async () => {\n    await ensureInit()\n    return authStore.fetchUser()\n  }\n\n  const ensureAuthenticated = async () => {\n    await ensureInit()\n    if (!authStore.isAuthenticated || !authStore.token) {\n      throw new Error('Not authenticated')\n    }\n    return authStore.token\n  }\n\n  return {\n    user: computed(() => authStore.user),\n    isAuthenticated: computed(() => authStore.isAuthenticated),\n    loading: computed(() => authStore.loading),\n    userRole: computed(() => authStore.userRole),\n    login,\n    register,\n    logout,\n    refreshUser,\n    ensureAuthenticated,\n  }\n}\n"],"version":3}