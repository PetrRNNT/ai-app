import{_ as S}from"./_5kmRz0s.js";import{g as A,c as r,a as t,t as o,F as _,r as v,m as u,o as i,n as C,C as $,D,E as p,j as N,b as I,w as L,k as x,l as T,z as M,d as P}from"./BAtAs9mt.js";import{u as V}from"./HdmTA0kg.js";const B={class:"space-y-6"},j={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},O={class:"card"},R={class:"text-3xl font-bold text-gray-900"},H={class:"card"},G={class:"text-3xl font-bold text-green-600"},W={class:"card"},z={class:"text-3xl font-bold text-blue-600"},U={class:"card"},F={class:"text-3xl font-bold text-purple-600"},q={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},J={class:"card"},K={class:"space-y-3"},Q={class:"text-sm text-gray-600"},X={class:"flex items-center gap-3"},Y={class:"w-32 bg-gray-200 rounded-full h-2"},Z={class:"text-sm font-medium text-gray-900 w-8 text-right"},tt={class:"card"},st={class:"space-y-3"},et={class:"text-sm text-gray-600"},at={class:"flex items-center gap-3"},lt={class:"w-32 bg-gray-200 rounded-full h-2"},ot={class:"text-sm font-medium text-gray-900 w-8 text-right"},nt={class:"card"},it={class:"h-48 flex items-end justify-between gap-2"},dt={class:"text-xs text-gray-600"},rt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ct={class:"card"},ut={class:"text-center py-8"},gt={class:"text-4xl font-bold text-blue-600 mb-2"},mt={class:"card"},xt={class:"space-y-4"},ht={class:"flex justify-between text-sm mb-1"},yt={class:"font-medium"},bt={class:"w-full bg-gray-200 rounded-full h-3"},ft={class:"flex justify-between text-sm mb-1"},_t={class:"font-medium"},vt={class:"w-full bg-gray-200 rounded-full h-3"},pt=A({__name:"Dashboard",props:{stats:{}},setup(e){const n=e,h=a=>({NEW:"Новые",IN_PROGRESS:"В процессе",PAUSED:"На паузе",WAITING:"Ожидание",COMPLETED:"Завершено",CANCELLED:"Отменено",ARCHIVED:"Архив"})[a]||a,y=a=>({NEW:"bg-blue-500",IN_PROGRESS:"bg-yellow-500",PAUSED:"bg-gray-500",WAITING:"bg-purple-500",COMPLETED:"bg-green-500",CANCELLED:"bg-red-500",ARCHIVED:"bg-gray-400"})[a]||"bg-gray-500",b=a=>({CRITICAL:"Критичный",HIGH:"Высокий",MEDIUM:"Средний",LOW:"Низкий",NONE:"Без приоритета"})[a]||a,f=a=>({CRITICAL:"bg-red-600",HIGH:"bg-red-500",MEDIUM:"bg-yellow-500",LOW:"bg-green-500",NONE:"bg-gray-400"})[a]||"bg-gray-500",g=(a,s)=>s?Math.round(a/s*100):0,w=a=>{const s=Math.max(...n.stats?.tasksCompletedByDay?.map(l=>l.count)||[1]);return s?Math.max(10,a/s*100):0},d=a=>{const s=Math.floor(a/3600),l=Math.floor(a%3600/60);return s>0?`${s}ч ${l}м`:`${l}м`},m=()=>{const a=n.stats?.estimatedVsActual?.estimated||0,s=n.stats?.estimatedVsActual?.actual||0;return Math.max(a,s,1)},E=()=>{const a=m();return`${(n.stats?.estimatedVsActual?.estimated||0)/a*100}%`},k=()=>{const a=m();return`${(n.stats?.estimatedVsActual?.actual||0)/a*100}%`};return(a,s)=>(i(),r("div",B,[t("div",j,[t("div",O,[s[0]||(s[0]=t("div",{class:"text-sm text-gray-500 mb-1"},"Всего задач",-1)),t("div",R,o(e.stats?.totalTasks||0),1)]),t("div",H,[s[1]||(s[1]=t("div",{class:"text-sm text-gray-500 mb-1"},"Завершено",-1)),t("div",G,o(e.stats?.completedTasks||0),1)]),t("div",W,[s[2]||(s[2]=t("div",{class:"text-sm text-gray-500 mb-1"},"Процент завершения",-1)),t("div",z,o(e.stats?.completionRate||0)+"%",1)]),t("div",U,[s[3]||(s[3]=t("div",{class:"text-sm text-gray-500 mb-1"},"Ср. время выполнения",-1)),t("div",F,o(e.stats?.avgCompletionTime||0)+"ч",1)])]),t("div",q,[t("div",J,[s[4]||(s[4]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Задачи по статусам",-1)),t("div",K,[(i(!0),r(_,null,v(e.stats?.tasksByStatus,(l,c)=>(i(),r("div",{key:c,class:"flex items-center justify-between"},[t("span",Q,o(h(c)),1),t("div",X,[t("div",Y,[t("div",{class:C(["h-2 rounded-full",y(c)]),style:u({width:`${g(l,e.stats?.totalTasks)}%`})},null,6)]),t("span",Z,o(l),1)])]))),128))])]),t("div",tt,[s[5]||(s[5]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Задачи по приоритетам",-1)),t("div",st,[(i(!0),r(_,null,v(e.stats?.tasksByPriority,(l,c)=>(i(),r("div",{key:c,class:"flex items-center justify-between"},[t("span",et,o(b(c)),1),t("div",at,[t("div",lt,[t("div",{class:C(["h-2 rounded-full",f(c)]),style:u({width:`${g(l,e.stats?.totalTasks)}%`})},null,6)]),t("span",ot,o(l),1)])]))),128))])])]),t("div",nt,[s[6]||(s[6]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Завершено задач за последние 7 дней",-1)),t("div",it,[(i(!0),r(_,null,v(e.stats?.tasksCompletedByDay,(l,c)=>(i(),r("div",{key:c,class:"flex-1 flex flex-col items-center gap-2"},[t("div",{class:"w-full bg-blue-500 rounded-t transition-all hover:bg-blue-600",style:u({height:`${w(l.count)}%`})},null,4),t("span",dt,o(l.date),1)]))),128))])]),t("div",rt,[t("div",ct,[s[8]||(s[8]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Учёт времени",-1)),t("div",ut,[t("div",gt,o(d(e.stats?.timeTracked||0)),1),s[7]||(s[7]=t("p",{class:"text-sm text-gray-500"},"всего отслежено за 30 дней",-1))])]),t("div",mt,[s[11]||(s[11]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"План vs Факт",-1)),t("div",xt,[t("div",null,[t("div",ht,[s[9]||(s[9]=t("span",{class:"text-gray-600"},"Оценено",-1)),t("span",yt,o(d(e.stats?.estimatedVsActual?.estimated||0)),1)]),t("div",bt,[t("div",{class:"bg-blue-500 h-3 rounded-full",style:u({width:E()})},null,4)])]),t("div",null,[t("div",ft,[s[10]||(s[10]=t("span",{class:"text-gray-600"},"Фактически",-1)),t("span",_t,o(d(e.stats?.estimatedVsActual?.actual||0)),1)]),t("div",vt,[t("div",{class:"bg-green-500 h-3 rounded-full",style:u({width:k()})},null,4)])])])])])]))}}),wt=Object.assign(pt,{__name:"AnalyticsDashboard"}),Ct=$("analytics",{state:()=>({stats:null,loading:!1,error:null}),getters:{productivityStats:e=>e.stats},actions:{async fetchStats(){this.loading=!0,this.error=null;try{const e=D(),n=await $fetch("/api/analytics",{headers:{Authorization:`Bearer ${e.token}`}});this.stats=n.data}catch(e){this.error=e.message||"Failed to fetch analytics"}finally{this.loading=!1}}}});function At(){const e=Ct(),n=async()=>e.fetchStats();return{stats:p(()=>e.stats),loading:p(()=>e.loading),error:p(()=>e.error),fetchStats:n}}const Et={class:"min-h-screen bg-gray-50"},kt={class:"bg-white shadow-sm border-b"},St={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},$t={class:"flex justify-between items-center h-16"},Dt={class:"flex items-center space-x-4"},Nt={class:"flex items-center space-x-4"},It={key:0,class:"text-sm text-gray-600"},Lt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},Tt={key:0,class:"flex justify-center items-center h-64"},Bt=A({__name:"index",setup(e){const{user:n,logout:h}=V(),{stats:y,loading:b,fetchStats:f}=At();N(async()=>{await f()});const g=async()=>{await h()};return(w,d)=>{const m=S;return i(),r("div",Et,[t("header",kt,[t("div",St,[t("div",$t,[t("div",Dt,[I(m,{to:"/",class:"text-blue-600 hover:underline"},{default:L(()=>[...d[0]||(d[0]=[P("← Назад",-1)])]),_:1}),d[1]||(d[1]=t("h1",{class:"text-xl font-bold text-gray-900"},"Аналитика",-1))]),t("div",Nt,[x(n)?(i(),r("span",It,o(x(n).name),1)):T("",!0),t("button",{onClick:g,class:"text-sm text-gray-600 hover:text-gray-900"}," Выйти ")])])])]),t("main",Lt,[x(b)?(i(),r("div",Tt,[...d[2]||(d[2]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1)])])):(i(),M(wt,{key:1,stats:x(y)},null,8,["stats"]))])])}}});export{Bt as default};
