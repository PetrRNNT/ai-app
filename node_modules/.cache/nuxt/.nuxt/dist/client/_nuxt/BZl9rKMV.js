import{_ as N}from"./_5kmRz0s.js";import{C as M,D as b,E as f,g as L,j as I,o as l,c as d,a as t,k as n,F as w,r as $,t as m,n as C,l as _,d as k,p as S,q as v,v as T,x as j,A as B,b as V,w as R}from"./BAtAs9mt.js";import{u as q}from"./HdmTA0kg.js";const F=M("automation",{state:()=>({automations:[],loading:!1,error:null}),getters:{activeAutomations:o=>o.automations.filter(a=>a.isActive)},actions:{async fetchAutomations(){this.loading=!0,this.error=null;try{const o=b(),a=await $fetch("/api/automations",{headers:{Authorization:`Bearer ${o.token}`}});this.automations=a.data}catch(o){this.error=o.message}finally{this.loading=!1}},async createAutomation(o){this.loading=!0,this.error=null;try{const a=b(),u=await $fetch("/api/automations",{method:"POST",headers:{Authorization:`Bearer ${a.token}`,"Content-Type":"application/json"},body:o});return this.automations.push(u.data),u.data}catch(a){throw this.error=a.message,a}finally{this.loading=!1}},async deleteAutomation(o){try{const a=b();await $fetch(`/api/automations/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${a.token}`}}),this.automations=this.automations.filter(u=>u.id!==o)}catch(a){throw this.error=a.message,a}},async toggleAutomation(o,a){const u=b(),c=await $fetch(`/api/automations/${o}`,{method:"PUT",headers:{Authorization:`Bearer ${u.token}`,"Content-Type":"application/json"},body:{isActive:a}}),p=this.automations.findIndex(i=>i.id===o);return p!==-1&&(this.automations[p]=c.data),c.data}}});function O(){const o=F(),a=async()=>o.fetchAutomations(),u=async i=>o.createAutomation(i),c=async i=>o.deleteAutomation(i),p=async(i,g)=>o.toggleAutomation(i,g);return{automations:f(()=>o.automations),activeAutomations:f(()=>o.activeAutomations),loading:f(()=>o.loading),error:f(()=>o.error),fetchAutomations:a,createAutomation:u,deleteAutomation:c,toggleAutomation:p}}const P={class:"space-y-4"},G={class:"flex justify-between items-center"},H={key:0,class:"text-center py-8"},J={key:1,class:"text-center py-8 text-gray-500"},K={key:2,class:"space-y-3"},Q={class:"flex-1"},W={class:"flex items-center gap-2 mb-1"},X={class:"font-semibold text-gray-900"},Y={key:0,class:"text-sm text-gray-600 mb-2"},Z={class:"text-xs text-gray-500"},tt={class:"bg-gray-100 px-1 rounded"},et={key:0,class:"ml-2"},st={class:"flex items-center gap-2"},ot=["onClick"],at=["onClick"],nt={class:"mb-4"},it={class:"mb-4"},rt={class:"space-y-2"},lt=["onUpdate:modelValue"],dt=["onClick"],ut={class:"flex justify-end gap-2"},ct=L({__name:"AutomationList",setup(o){const{automations:a,loading:u,fetchAutomations:c,createAutomation:p,deleteAutomation:i,toggleAutomation:g}=O(),y=B(!1),r=B({name:"",description:"",triggerType:"task.created",actions:[{type:"task.updateStatus"}]});I(async()=>{await c()});const D=async()=>{await p({name:r.value.name,description:r.value.description,trigger:{type:r.value.triggerType},actions:r.value.actions}),y.value=!1,r.value={name:"",description:"",triggerType:"task.created",actions:[{type:"task.updateStatus"}]}},U=async x=>{confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ?")&&await i(x)},z=async(x,e)=>{await g(x,e)},E=x=>new Date(x).toLocaleDateString("ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"});return(x,e)=>(l(),d("div",P,[t("div",G,[e[8]||(e[8]=t("h3",{class:"text-lg font-semibold text-gray-900"},"–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è",-1)),t("button",{onClick:e[0]||(e[0]=s=>y.value=!0),class:"btn-primary text-sm"}," + –ù–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ ")]),n(u)?(l(),d("div",H,[...e[9]||(e[9]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"},null,-1)])])):n(a).length===0?(l(),d("div",J," –ù–µ—Ç –ø—Ä–∞–≤–∏–ª –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ! ")):(l(),d("div",K,[(l(!0),d(w,null,$(n(a),s=>(l(),d("div",{key:s.id,class:"card flex items-center justify-between"},[t("div",Q,[t("div",W,[t("h4",X,m(s.name),1),t("span",{class:C(["px-2 py-0.5 rounded text-xs",s.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},m(s.isActive?"–ê–∫—Ç–∏–≤–Ω–æ":"–ù–µ–∞–∫—Ç–∏–≤–Ω–æ"),3)]),s.description?(l(),d("p",Y,m(s.description),1)):_("",!0),t("div",Z,[e[10]||(e[10]=k(" –¢—Ä–∏–≥–≥–µ—Ä: ",-1)),t("code",tt,m(s.trigger?.type),1),k(" ‚Ä¢ –î–µ–π—Å—Ç–≤–∏–π: "+m(s.actions?.length||0)+" ",1),s.lastRun?(l(),d("span",et," ‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: "+m(E(s.lastRun)),1)):_("",!0)])]),t("div",st,[t("button",{onClick:h=>z(s.id,!s.isActive),class:C(["px-3 py-1 rounded text-sm",s.isActive?"btn-secondary":"btn-primary"])},m(s.isActive?"–û—Ç–∫–ª—é—á–∏—Ç—å":"–í–∫–ª—é—á–∏—Ç—å"),11,ot),t("button",{onClick:h=>U(s.id),class:"text-gray-400 hover:text-red-600 p-2"}," üóëÔ∏è ",8,at)])]))),128))])),n(y)?(l(),d("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e[7]||(e[7]=s=>y.value=!1)},[t("div",{class:"bg-white rounded-lg p-6 w-full max-w-lg",onClick:e[6]||(e[6]=S(()=>{},["stop"]))},[e[16]||(e[16]=t("h3",{class:"text-lg font-semibold mb-4"},"–ù–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏",-1)),t("form",{onSubmit:S(D,["prevent"])},[v(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>n(r).name=s),type:"text",placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞",class:"input-base mb-4",required:""},null,512),[[T,n(r).name]]),v(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>n(r).description=s),placeholder:"–û–ø–∏—Å–∞–Ω–∏–µ",class:"input-base mb-4",rows:"2"},null,512),[[T,n(r).description]]),t("div",nt,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"–¢—Ä–∏–≥–≥–µ—Ä",-1)),v(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>n(r).triggerType=s),class:"input-base mb-2"},[...e[11]||(e[11]=[t("option",{value:"task.created"},"–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏",-1),t("option",{value:"task.completed"},"–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏",-1),t("option",{value:"task.dueSoon"},"–ö–æ–≥–¥–∞ –∑–∞–¥–∞—á–∞ —Å–∫–æ—Ä–æ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞",-1)])],512),[[j,n(r).triggerType]])]),t("div",it,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"–î–µ–π—Å—Ç–≤–∏—è",-1)),t("div",rt,[(l(!0),d(w,null,$(n(r).actions,(s,h)=>(l(),d("div",{key:h,class:"flex gap-2"},[v(t("select",{"onUpdate:modelValue":A=>s.type=A,class:"input-base text-sm flex-1"},[...e[13]||(e[13]=[t("option",{value:"task.updateStatus"},"–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏",-1),t("option",{value:"task.addTag"},"–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥",-1),t("option",{value:"notification.send"},"–û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ",-1)])],8,lt),[[j,s.type]]),t("button",{type:"button",onClick:A=>n(r).actions.splice(h,1),class:"text-red-600 hover:text-red-800"}," ‚úï ",8,dt)]))),128)),t("button",{type:"button",onClick:e[4]||(e[4]=s=>n(r).actions.push({type:"task.updateStatus"})),class:"text-blue-600 hover:text-blue-800 text-sm"}," + –î–æ–±–∞–≤–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ ")])]),t("div",ut,[t("button",{type:"button",onClick:e[5]||(e[5]=s=>y.value=!1),class:"btn-secondary"},"–û—Ç–º–µ–Ω–∞"),e[15]||(e[15]=t("button",{type:"submit",class:"btn-primary"},"–°–æ–∑–¥–∞—Ç—å",-1))])],32)])])):_("",!0)]))}}),mt=Object.assign(ct,{__name:"AutomationList"}),pt={class:"min-h-screen bg-gray-50"},yt={class:"bg-white shadow-sm border-b"},xt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},gt={class:"flex justify-between items-center h-16"},ht={class:"flex items-center space-x-4"},bt={class:"flex items-center space-x-4"},ft={key:0,class:"text-sm text-gray-600"},vt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},wt=L({__name:"index",setup(o){const{user:a,logout:u}=q(),c=async()=>{await u()};return(p,i)=>{const g=N,y=mt;return l(),d("div",pt,[t("header",yt,[t("div",xt,[t("div",gt,[t("div",ht,[V(g,{to:"/",class:"text-blue-600 hover:underline"},{default:R(()=>[...i[0]||(i[0]=[k("‚Üê –ù–∞–∑–∞–¥",-1)])]),_:1}),i[1]||(i[1]=t("h1",{class:"text-xl font-bold text-gray-900"},"–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è",-1))]),t("div",bt,[n(a)?(l(),d("span",ft,m(n(a).name),1)):_("",!0),t("button",{onClick:c,class:"text-sm text-gray-600 hover:text-gray-900"}," –í—ã–π—Ç–∏ ")])])])]),t("main",vt,[V(y)])])}}});export{wt as default};
