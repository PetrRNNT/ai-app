import{D as g,E as r,L as f}from"./BAtAs9mt.js";let i=null;function y(){const t=g(),a=async()=>{i||(i=t.initAuth()),await i},u=async(n,o)=>{await a(),t.setLoading(!0);try{const e=await $fetch("/api/auth",{method:"POST",body:{email:n,password:o}});return t.setAuth(e.data,e.token),{success:!0}}catch(e){return t.setLoading(!1),{success:!1,error:e.message||"Login failed"}}},c=async(n,o,e)=>{await a(),t.setLoading(!0);try{const s=await $fetch("/api/auth",{method:"POST",body:{email:n,name:o,password:e}});return t.setAuth(s.data,s.token),{success:!0}}catch(s){return t.setLoading(!1),{success:!1,error:s.message||"Registration failed"}}},d=async()=>{await t.logout(),f("/login")},h=async()=>(await a(),t.fetchUser()),l=async()=>{if(await a(),!t.isAuthenticated||!t.token)throw new Error("Not authenticated");return t.token};return{user:r(()=>t.user),isAuthenticated:r(()=>t.isAuthenticated),loading:r(()=>t.loading),userRole:r(()=>t.userRole),login:u,register:c,logout:d,refreshUser:h,ensureAuthenticated:l}}export{y as u};
