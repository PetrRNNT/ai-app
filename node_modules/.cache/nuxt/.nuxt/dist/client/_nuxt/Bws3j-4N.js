import{C as h,D as o}from"./BAtAs9mt.js";const d=h("task",{state:()=>({tasks:[],currentTask:null,loading:!1,error:null,filters:{}}),getters:{allTasks:e=>e.tasks,filteredTasks:e=>{let t=e.tasks;if(e.filters.status?.length&&(t=t.filter(r=>r.status&&e.filters.status?.includes(r.status))),e.filters.priority?.length&&(t=t.filter(r=>r.priority&&e.filters.priority?.includes(r.priority))),e.filters.projectId&&(t=t.filter(r=>r.projectId===e.filters.projectId)),e.filters.search){const r=e.filters.search.toLowerCase();t=t.filter(a=>a.title.toLowerCase().includes(r)||a.description?.toLowerCase().includes(r))}return e.filters.isImportant!==void 0&&(t=t.filter(r=>r.isImportant===e.filters.isImportant)),t},completedTasks:e=>e.tasks.filter(t=>t.status==="COMPLETED"),pendingTasks:e=>e.tasks.filter(t=>t.status!=="COMPLETED"),importantTasks:e=>e.tasks.filter(t=>t.isImportant)},actions:{setFilters(e){this.filters=e},clearFilters(){this.filters={}},async fetchTasks(e){this.loading=!0,this.error=null;try{const t=e?new URLSearchParams(e).toString():"",r=t?`/api/tasks?${t}`:"/api/tasks",s=o().validToken;if(!s)throw new Error("Not authenticated");const i=await $fetch(r,{headers:{Authorization:`Bearer ${s}`}});this.tasks=i.data}catch(t){this.error=t.message||"Failed to fetch tasks"}finally{this.loading=!1}},async fetchTaskById(e){this.loading=!0,this.error=null;try{const r=o().validToken;if(!r)throw new Error("Not authenticated");const a=await $fetch(`/api/tasks/${e}`,{headers:{Authorization:`Bearer ${r}`}});return this.currentTask=a.data,a.data}catch(t){throw this.error=t.message||"Failed to fetch task",t}finally{this.loading=!1}},async createTask(e){this.loading=!0,this.error=null;try{const r=o().validToken;if(!r)throw new Error("Not authenticated. Please log in again.");const a=await $fetch("/api/tasks",{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:e});return this.tasks.push(a.data),a.data}catch(t){throw this.error=t.message||"Failed to create task",t}finally{this.loading=!1}},async updateTask(e){this.loading=!0,this.error=null;try{const r=o().validToken;if(!r)throw new Error("Not authenticated");const{id:a,...s}=e,i=await $fetch(`/api/tasks/${a}`,{method:"PUT",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:s}),n=this.tasks.findIndex(l=>l.id===a);return n!==-1&&(this.tasks[n]=i.data),this.currentTask?.id===a&&(this.currentTask=i.data),i.data}catch(t){throw this.error=t.message||"Failed to update task",t}finally{this.loading=!1}},async deleteTask(e){this.loading=!0,this.error=null;try{const r=o().validToken;if(!r)throw new Error("Not authenticated");await $fetch(`/api/tasks/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}}),this.tasks=this.tasks.filter(a=>a.id!==e)}catch(t){throw this.error=t.message||"Failed to delete task",t}finally{this.loading=!1}},async completeTask(e){this.loading=!0,this.error=null;try{const r=o().validToken;if(!r)throw new Error("Not authenticated");const a=await $fetch(`/api/tasks/${e}/complete`,{method:"POST",headers:{Authorization:`Bearer ${r}`}}),s=this.tasks.findIndex(i=>i.id===e);return s!==-1&&(this.tasks[s]=a.data),a.data}catch(t){throw this.error=t.message||"Failed to complete task",t}finally{this.loading=!1}}}});export{d as u};
